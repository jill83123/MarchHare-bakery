import{c as C,o as a,d,e,l as u,v as h,S as U,n as _,t as l,M as V,g as p,h as f,F as y,i as D,s as z,b as E,r as m,f as b}from"./index-bf4ebe37.js";import{s as j}from"./statesStore-1222e2d4.js";import{P as A,D as T}from"./PaginationBackend-4f3459f0.js";import{k as $}from"./tw-elements.es.min-69e8dc80.js";import{m as N}from"./modalMixin-a9be93c2.js";const P={data(){return{tempOrder:{user:{order:{}},products:{}},selectEl:{}}},watch:{item(){this.tempOrder=this.item,$.getOrCreateInstance(this.selectEl).setValue(this.tempOrder.user.order.status)}},computed:{isUsedCoupon(){return Object.values(this.tempOrder.products).some(r=>r.coupon)}},props:["item"],mixins:[N],mounted(){this.selectEl=this.$refs.statusSelect,$.getOrCreateInstance(this.selectEl)}},B={"data-te-modal-init":"",class:"fixed left-0 top-0 z-[1055] hidden h-full w-full overflow-y-auto overflow-x-hidden outline-none",id:"exampleModalXl",tabindex:"-1","aria-labelledby":"exampleModalXlLabel","aria-modal":"true",role:"dialog",ref:"modal"},F={"data-te-modal-dialog-ref":"",class:"pointer-events-none relative mx-auto mt-7 w-auto max-w-[500px] translate-y-[-50px] opacity-0 transition-all duration-300 ease-in-out min-[992px]:max-w-[800px] min-[1200px]:max-w-[1180px]"},q={class:"pointer-events-auto relative flex max-h-[calc(100vh_-_56px)] w-full flex-col rounded-md border-none bg-white bg-clip-padding text-current shadow-lg outline-none"},I=z('<div class="flex flex-shrink-0 items-center justify-between rounded-t-md border-b-2 border-neutral-100 border-opacity-100 p-4"><h5 class="text-xl font-medium leading-normal text-neutral-800" id="exampleModalXlLabel">編輯訂單</h5><button type="button" class="box-content rounded-none border-none hover:no-underline hover:opacity-75 focus:opacity-100 focus:shadow-none focus:outline-none" data-te-modal-dismiss aria-label="Close"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg></button></div>',1),X={key:0,class:"relative overflow-y-scroll p-4"},G={class:"flex flex-col pb-6 pt-4 min-[1200px]:flex-row"},R={class:"min-[1200px]:w-1/3"},H={class:"h-full px-2"},J={class:"mb-4 flex gap-2"},K={class:"w-1/2"},Q=e("label",{for:"name",class:"mb-1 block"},"收件人姓名",-1),W={class:"w-1/2"},Y=e("label",{for:"tel",class:"mb-1 block"},"收件人電話",-1),Z={class:"mb-4"},ee=e("label",{for:"mail",class:"mb-1 block"},"E-mail",-1),te={class:"mb-4"},se=e("label",{for:"address",class:"mb-1 block"},"地址",-1),oe={class:"mb-4 pb-4"},re=e("label",{for:"message",class:"mb-1 block"},"留言",-1),le=["checked"],ne={class:"min-[1200px]:w-2/3"},ae={class:"mb-6 flex items-end justify-end"},de={class:"w-[170px] text-gray-500"},ie=e("label",{for:"statusSelect",class:"text-sm"},"訂單狀態",-1),ce=e("option",{value:"收到訂單",selected:""},"收到訂單",-1),pe=e("option",{value:"準備中"},"準備中",-1),ue=e("option",{value:"已完成（寄出）"},"已完成（寄出）",-1),he=e("option",{value:"已取貨"},"已取貨",-1),_e=[ce,pe,ue,he],fe={class:"max-h-[calc(100vh_-_280px)] overflow-x-auto"},xe={class:"inline-block min-w-full py-2 sm:px-3"},me={class:"overflow-hidden"},be={class:"min-w-full overflow-y-scroll text-left text-sm"},ge={class:"border-b border-gray-400 font-medium text-black"},ye=e("th",{scope:"col",class:"w-[5%] px-1 py-4 md:px-4"},"#",-1),we=e("th",{scope:"col",class:"px-1 py-4 max-[500px]:w-[45%] md:px-4"},"清單",-1),ve={scope:"col",class:"w-[25%] px-1 py-4 max-[500px]:w-[35%] md:px-4"},ke={key:0,class:"-ml-2 block text-xs text-success"},Oe=e("th",{scope:"col",class:"w-[10%] px-0 py-4 md:px-4"},"數量",-1),Me={class:"text-black-light"},$e={class:"px-2 py-4 font-medium md:px-4"},Ce={class:"px-1 py-4 md:px-4"},De={class:"flex flex-col gap-2 min-[500px]:flex-row md:gap-8"},Le=["src","alt"],Se={class:"flex flex-col justify-center"},Ue={class:"mb-2"},Ve={class:"mb-1 mr-1 inline-block font-medium text-black lg:text-xl"},ze={key:0,class:"op ml-2 rounded-full bg-success px-2 font-montserrat text-xs text-white"},Ee=e("br",null,null,-1),je={class:"px-2 py-4 text-xs tracking-wider max-[500px]:text-center sm:text-left sm:text-sm md:px-4"},Ae=e("span",{class:"mr-[2px] hidden sm:inline-block"},"NT",-1),Te={class:"px-2 py-4 md:px-4"},Ne={class:"flex items-center"},Pe={class:"hidden pl-2 text-sm text-gray-400 sm:inline-block"},Be={class:"border-t border-gray-200 text-base font-bold tracking-wider text-brown-500"},Fe={class:"px-1 py-4 md:px-4",colspan:"2"},qe={class:"flex items-center justify-between"},Ie={class:"text-gray-500"},Xe={class:"px-1 py-4 text-center md:px-4 md:text-start",colspan:"3"},Ge={class:"-ml-2 text-sm"},Re={class:"flex flex-shrink-0 flex-wrap items-center justify-end gap-2 rounded-b-md border-t-2 border-neutral-100 border-opacity-100 p-4"},He=e("button",{type:"button",class:"active:bg-cerulean-700 inline-block rounded border border-gray-300 bg-transparent px-[23px] py-[9px] text-right text-sm font-medium uppercase leading-normal text-black transition duration-150 ease-in-out hover:bg-gray-100 hover:opacity-80 focus:outline-none focus:ring-0","data-te-modal-dismiss":""}," 取消 ",-1);function Je(r,o,i,x,s,c){return a(),d("div",B,[e("div",F,[e("div",q,[I,s.tempOrder?(a(),d("div",X,[e("div",G,[e("div",R,[e("div",H,[e("div",J,[e("div",K,[Q,u(e("input",{type:"text",class:"m-0 block w-full rounded border border-solid border-neutral-300 bg-clip-padding px-3 py-[6px] text-base font-normal leading-[1.6] text-black outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",id:"name","onUpdate:modelValue":o[0]||(o[0]=t=>s.tempOrder.user.name=t)},null,512),[[h,s.tempOrder.user.name]])]),e("div",W,[Y,u(e("input",{type:"tel",class:"m-0 block w-full rounded border border-solid border-neutral-300 bg-clip-padding px-3 py-[6px] text-base font-normal leading-[1.6] text-black outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",id:"tel","onUpdate:modelValue":o[1]||(o[1]=t=>s.tempOrder.user.tel=t)},null,512),[[h,s.tempOrder.user.tel]])])]),e("div",Z,[ee,u(e("input",{type:"email",class:"m-0 block w-full rounded border border-solid border-neutral-300 bg-clip-padding px-3 py-[6px] text-base font-normal leading-[1.6] text-black outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",id:"mail","onUpdate:modelValue":o[2]||(o[2]=t=>s.tempOrder.user.email=t)},null,512),[[h,s.tempOrder.user.email]])]),e("div",te,[se,u(e("input",{type:"text",class:"m-0 block w-full rounded border border-solid border-neutral-300 bg-clip-padding px-3 py-[6px] text-base font-normal leading-[1.6] text-black outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",id:"address","onUpdate:modelValue":o[3]||(o[3]=t=>s.tempOrder.user.address=t)},null,512),[[h,s.tempOrder.user.address]])]),e("div",oe,[re,u(e("textarea",{type:"text",class:"m-0 block min-h-[100px] w-full resize-none rounded border border-solid border-neutral-300 bg-clip-padding px-3 py-[6px] text-base font-normal leading-[1.6] text-black outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",id:"message","onUpdate:modelValue":o[4]||(o[4]=t=>s.tempOrder.message=t)},null,512),[[h,s.tempOrder.message]])]),e("div",null,[u(e("input",{class:"mr-2 mt-[0.3rem] h-3.5 w-8 appearance-none rounded-[0.4375rem] bg-neutral-300 before:pointer-events-none before:absolute before:h-3.5 before:w-3.5 before:rounded-full before:bg-transparent before:content-[''] after:absolute after:z-[2] after:-mt-[0.1875rem] after:h-5 after:w-5 after:rounded-full after:border-none after:bg-neutral-100 after:shadow-[0_0px_3px_0_rgb(0_0_0_/_7%),_0_2px_2px_0_rgb(0_0_0_/_4%)] after:transition-[background-color_0.2s,transform_0.2s] after:content-[''] checked:bg-success checked:after:absolute checked:after:z-[2] checked:after:-mt-[3px] checked:after:ml-[1.0625rem] checked:after:h-5 checked:after:w-5 checked:after:rounded-full checked:after:border-none checked:after:bg-neutral-100 checked:after:shadow-[0_3px_1px_-2px_rgba(0,0,0,0.2),_0_2px_2px_0_rgba(0,0,0,0.14),_0_1px_5px_0_rgba(0,0,0,0.12)] checked:after:transition-[background-color_0.2s,transform_0.2s] checked:after:content-[''] hover:cursor-pointer focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[3px_-1px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] focus:after:absolute focus:after:z-[1] focus:after:block focus:after:h-5 focus:after:w-5 focus:after:rounded-full focus:after:content-[''] checked:focus:border-success checked:focus:bg-success checked:focus:before:ml-[1.0625rem] checked:focus:before:scale-100 checked:focus:before:shadow-[3px_-1px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s]",type:"checkbox",role:"switch",id:"flexSwitchCheckDefault",checked:s.tempOrder.user.order.is_paid,"onUpdate:modelValue":o[5]||(o[5]=t=>s.tempOrder.user.order.is_paid=t)},null,8,le),[[U,s.tempOrder.user.order.is_paid]]),e("label",{class:_(["ml-1 inline-block pl-[0.15rem] font-semibold hover:cursor-pointer",s.tempOrder.user.order.is_paid?"text-success":"text-danger"]),for:"flexSwitchCheckDefault"},l(s.tempOrder.user.order.is_paid?"已付款":"尚未付款"),3)])])]),e("div",ne,[e("div",ae,[e("div",de,[ie,u(e("select",{"data-te-select-init":"","data-te-class-select-Label":"data-[te-input-state-active]:scale-1 absolute top-[18%] left-[5%] pointer-events-none",id:"statusSelect","onUpdate:modelValue":o[6]||(o[6]=t=>s.tempOrder.user.order.status=t),ref:"statusSelect"},_e,512),[[V,s.tempOrder.user.order.status]])])]),e("div",fe,[e("div",xe,[e("div",me,[e("table",be,[e("thead",ge,[e("tr",null,[ye,we,e("th",ve,[p(" 小計 "),c.isUsedCoupon?(a(),d("span",ke,l(c.isUsedCoupon?"（已使用優惠券）":""),1)):f("",!0)]),Oe])]),e("tbody",Me,[(a(!0),d(y,null,D(s.tempOrder.products,(t,w,g)=>(a(),d("tr",{class:"border-b border-gray-200 hover:bg-neutral-100",key:t.id},[e("td",$e,l(g+1),1),e("td",Ce,[e("div",De,[e("img",{class:"w-full object-cover min-[500px]:w-[130px]",src:t.product.imageUrl,alt:t.product.title},null,8,Le),e("div",Se,[e("div",Ue,[e("h4",Ve,l(t.product.title),1),t.product.price!==t.product.origin_price?(a(),d("span",ze,"SALE ")):f("",!0),Ee,e("span",{class:_(["text-xs tracking-wider text-gray-500",{"line-through":t.product.price!==t.product.origin_price}])}," NT "+l(r.$filters.currency(t.product.origin_price))+" 元 ",3),t.product.price!==t.product.origin_price?(a(),d("span",{key:1,class:_(["text-xs tracking-wider text-gray-500",{"ml-2 font-bold text-success":t.product.price!==t.product.origin_price}])},[p(" NT "),e("span",null,l(r.$filters.currency(t.product.price)),1),p(" 元 ")],2)):f("",!0)])])])]),e("td",je,[e("span",{class:_({"font-bold text-success":t.total!==t.final_total})},[Ae,e("span",null,l(t.total===t.final_total?r.$filters.currency(t.total*t.qty):r.$filters.currency(t.final_total)),1),p(" 元 ")],2)]),e("td",Te,[e("div",Ne,[p(l(t.product.qty?t.product.qty:1)+" ",1),e("span",Pe,l(t.product.unit),1)])])]))),128))]),e("tfoot",Be,[e("td",Fe,[e("div",qe,[p(l(Object.keys(s.tempOrder.products).length)+" 個商品 ",1),e("div",Ie,l(s.tempOrder.user.order.pickupMethod==="delivery"?"宅配":"到店自取"),1)])]),e("td",Xe,[p(" 共 NT "+l(r.$filters.currency(s.tempOrder.total))+" 元 ",1),e("p",Ge,l(s.tempOrder.user.order.pickupMethod==="delivery"?"（含運費 80 元）":""),1)])])])])])])])])])):f("",!0),e("div",Re,[He,e("button",{type:"button",class:"active:bg-cerulean-700 inline-block rounded bg-cerulean px-6 py-2.5 text-right text-sm font-medium uppercase leading-normal text-white transition duration-150 ease-in-out hover:opacity-80 focus:outline-none focus:ring-0",onClick:o[7]||(o[7]=t=>r.$emit("update-order",this.tempOrder))}," 確認 ")])])])],512)}const Ke=C(P,[["render",Je]]),Qe={data(){return{orderList:[],tempOrder:{},orderModalState:"",pagination:{},isLoading:!1}},methods:{...E(j,["pushToastMessage"]),getOrders(r=1){this.isLoading=!0;const o=`https://vue3-course-api.hexschool.io/api/yu-api/admin/orders?page=${r}`;this.$http.get(o).then(i=>{i.data.success&&(this.orderList=i.data.orders,this.pagination=i.data.pagination,this.isLoading=!1)})},updateOrder(){const r=Math.floor(new Date().getTime()/1e3);this.tempOrder.lastEditDate=r;const o=`https://vue3-course-api.hexschool.io/api/yu-api/admin/order/${this.tempOrder.id}`,i={data:{...this.tempOrder}};this.$http.put(o,i).then(x=>{x.data.success&&(this.getOrders(),this.$refs.orderModal.hideModal(),this.pushToastMessage(x.data.success,"更新成功"))})},openModal(r,o){if(this.orderModalState=r,(r==="edit"||r==="del")&&(this.tempOrder={...o}),r==="del"||r==="delAll"){this.tempOrder.title="訂單",r==="delAll"&&(this.tempOrder.title="全部"),this.$refs.delModal.showModal();return}this.$refs.orderModal.showModal()},delOrder(r){let o=`https://vue3-course-api.hexschool.io/api/yu-api/admin/order/${r.id}`;this.orderModalState==="delAll"&&(o="https://vue3-course-api.hexschool.io/api/yu-api/admin/orders/all"),this.$http.delete(o).then(i=>{i.data.success&&(this.getOrders(),this.$refs.delModal.hideModal(),this.pushToastMessage(i.data.success,"刪除成功"))})},delAllOrder(){}},created(){this.getOrders()},components:{Pagination:A,OrderModal:Ke,DelModal:T}},We={class:"ml-0 lg:ml-[310px]"},Ye={class:"container flex justify-between py-4 lg:mt-10 lg:text-right"},Ze=e("h2",{class:"flex items-center font-noto-serif text-3xl text-black"},[e("span",{class:"material-symbols-outlined mr-2 text-4xl text-black-light"},"Contract_Edit"),p(" 訂單管理 ")],-1),et=e("span",{class:"material-symbols-outlined -ml-1 mr-2"},"Delete_Forever",-1),tt={class:"container mb-11 flex min-h-[679px] flex-col"},st={class:"overflow-x-auto"},ot={class:"inline-block min-w-full py-2"},rt={class:"overflow-hidden"},lt={class:"min-w-full text-left text-sm font-light"},nt=e("thead",{class:"break-keep border-b border-gray-400 font-medium"},[e("tr",null,[e("th",{scope:"col",class:"w-[1%] px-6 py-4"},"#"),e("th",{scope:"col",class:"px-6 py-4"},"訂單狀態"),e("th",{scope:"col",class:"px-6 py-4"},"成立時間"),e("th",{scope:"col",class:"px-6 py-4"},"訂單編號"),e("th",{scope:"col",class:"px-6 py-4"},"姓名"),e("th",{scope:"col",class:"px-6 py-4"},"電話"),e("th",{scope:"col",class:"px-6 py-4"},"取貨方式"),e("th",{scope:"col",class:"px-6 py-4"},"付款狀態"),e("th",{scope:"col",class:"px-6 py-4"},"最後更新時間"),e("th",{scope:"col",class:"px-6 py-4"},"編輯")])],-1),at={class:"whitespace-nowrap px-6 py-4"},dt={class:"whitespace-nowrap px-6 py-4"},it={class:"whitespace-nowrap px-6 py-4"},ct={class:"whitespace-nowrap px-6 py-4"},pt={class:"whitespace-nowrap px-6 py-4"},ut={class:"whitespace-nowrap px-6 py-4"},ht={class:"whitespace-nowrap px-6 py-4"},_t={class:"whitespace-nowrap px-6 py-4"},ft={key:0},xt={class:"whitespace-nowrap px-6 py-4"},mt=["onClick"],bt=e("span",{class:"material-symbols-outlined",style:{"font-variation-settings":`'FILL' 1,
                            'wght' 400,
                            'GRAD' 0,
                            'opsz' 24`}}," edit ",-1),gt=[bt],yt=["onClick"],wt=e("span",{class:"material-symbols-outlined"},"delete",-1),vt=[wt];function kt(r,o,i,x,s,c){const t=m("LoadingAnimation"),w=m("Pagination"),g=m("OrderModal"),L=m("DelModal");return a(),d(y,null,[b(t,{active:s.isLoading,"lock-scroll":!0},null,8,["active"]),e("main",We,[e("div",Ye,[Ze,e("button",{type:"button",class:"active:bg-cerulean-700 my-auto flex items-center rounded bg-cerulean px-6 py-2.5 text-sm font-medium uppercase leading-normal text-white transition duration-150 ease-in-out hover:opacity-80 focus:outline-none focus:ring-0",onClick:o[0]||(o[0]=n=>c.openModal("delAll",r.item))},[et,p(" 刪除全部 ")])]),e("div",tt,[e("div",st,[e("div",ot,[e("div",rt,[e("table",lt,[nt,e("tbody",null,[(a(!0),d(y,null,D(s.orderList,n=>{var v,k,O,M;return a(),d("tr",{key:n.id,class:"border-b font-normal transition duration-300 ease-in-out hover:bg-neutral-100"},[e("th",at,l(n.num),1),e("td",dt,l((v=n.user.order)==null?void 0:v.status),1),e("td",it,l(r.$filters.date(n.create_at)),1),e("td",ct,l(n.id),1),e("td",pt,l(n.user.name),1),e("td",ut,l(n.user.tel),1),e("td",ht,l(((k=n.user.order)==null?void 0:k.pickupMethod)==="self"?"到店自取":"宅配"),1),e("td",{class:_(["whitespace-nowrap px-6 py-4 font-bold",(O=n.user.order)!=null&&O.is_paid?"text-success":"text-danger"])},l((M=n.user.order)!=null&&M.is_paid?"已付款":"未付款"),3),e("td",_t,[n.lastEditDate?(a(),d("p",ft,l(r.$filters.date(n.lastEditDate)),1)):f("",!0)]),e("td",xt,[e("button",{type:"button",class:"inline-block pr-4 hover:text-cerulean",onClick:S=>c.openModal("edit",n)},gt,8,mt),e("button",{type:"button",class:"inline-block px-4 hover:text-danger",onClick:S=>c.openModal("del",n)},vt,8,yt)])])}),128))])])])])])]),b(w,{pages:s.pagination,onChangePage:c.getOrders},null,8,["pages","onChangePage"]),b(g,{ref:"orderModal",onUpdateOrder:c.updateOrder,item:s.tempOrder},null,8,["onUpdateOrder","item"]),b(L,{ref:"delModal",onDel:c.delOrder,item:s.tempOrder},null,8,["onDel","item"])])],64)}const Lt=C(Qe,[["render",kt]]);export{Lt as default};
