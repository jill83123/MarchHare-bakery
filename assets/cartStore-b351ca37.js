import{z as u,L as p,O as c}from"./index-bf4ebe37.js";import{a as i}from"./base-593d189d.js";import{S as r}from"./swalMixin-1ccae8ce.js";const m={final_total:80,id:"-Nfviy3OLgcT7GnSUqUV",qty:1,price:80,category:"運費",imageUrl:"https://storage.googleapis.com/vue-course-api.appspot.com/yu-api/1696471229222.jpg",num:1,origin_price:80,title:"運費",unit:"個"},h=async t=>(await i.post("/cart",t)).data,f=async()=>(await i.delete("/carts")).data,g=async t=>(await i.post("/coupon",t)).data,L=async t=>(await i.post("/order",t)).data,I=async t=>(await i.get(`/order/${t}`)).data.order,{addLoadingItem:n,removeLoadingItem:o}=u(),C=p("cart",{state:()=>({cartList:[],cartTotalPrice:0,finalTotalPrice:0,status:{updateIcon:"",loadingIcon:"",coupon:!1},currentStep:1,userInfo:{user:{name:"",email:"",tel:"",address:"",order:{is_paid:!1,status:"",pickup:""}},message:""},OrderData:{}}),actions:{getCartList(){this.cartList=JSON.parse(localStorage.getItem("cartList"))||[],this.cartTotalPrice=0,this.cartList.forEach(t=>{this.cartTotalPrice+=t.final_total})},addToCart(t,s=1){const a=this.cartList.find(e=>e.product.id===t.id);if(a)a.qty+=s,a.final_total=t.price*a.qty;else{const e={product:t,id:t.id,qty:s,final_total:t.price*s};this.cartList.push(e)}localStorage.setItem("cartList",JSON.stringify(this.cartList)),r.methods.showSwalToast("success","加入購物車"),this.getCartList()},updateCart(t,s){const a=this.cartList.find(e=>e.id===t);a.qty=s,a.final_total=a.product.price*a.qty,localStorage.setItem("cartList",JSON.stringify(this.cartList)),r.methods.showSwalToast("success","更新購物車"),this.getCartList()},delCartItem(t,s){const a=this.cartList.findIndex(e=>e.id===s);t==="all"&&(this.cartList=[],r.methods.showSwalToast("success","已清空購物車")),t==="one"&&(this.cartList.splice(a,1),r.methods.showSwalToast("success","已刪除商品")),localStorage.setItem("cartList",JSON.stringify(this.cartList)),this.getCartList()},async checkCartList(t){var s,a;n("checkCartList");try{await h({data:{product_id:this.cartList[0].product.id,qty:this.cartList[0].qty}}),await f(),this.userInfo.user.order.pickupMethod=t,t==="delivery"&&this.addToCart(m,1),t==="self"&&(this.userInfo.user.address="到店自取");let e=0;this.cartList.forEach(async d=>{const l={data:{product_id:d.product.id,qty:d.qty}};await h(l),e+=1,e===this.cartList.length&&(c.push("/checkout/information"),o("checkCartList"))})}catch(e){r.methods.showSwalToast("error",(a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message),o("checkCartList")}},updateCurrentStep(t){t===2&&(this.status.coupon=!1),this.currentStep=t},pushUserInfo(t){this.userInfo=t},async useCoupon(t){var s,a;n("useCoupon");try{const e=await g({data:{code:t}});this.status.coupon=!0,this.finalTotalPrice=e.data.final_total,r.methods.showSwalToast("success","套用成功")}catch(e){r.methods.showSwalToast("error",(a=(s=e.response)==null?void 0:s.data)==null?void 0:a.message)}o("useCoupon")},async submitOrder(){var t,s;n("submitOrder");try{this.userInfo.user.order.status="收到訂單",this.OrderData=await L({data:this.userInfo}),this.cartList=[],localStorage.setItem("cartList",JSON.stringify(this.cartList)),c.replace("/checkout/complete")}catch(a){r.methods.showSwalToast("error",(s=(t=a.response)==null?void 0:t.data)==null?void 0:s.message)}o("submitOrder")},shoppingMore(){this.userInfo={user:{name:"",email:"",tel:"",address:""},message:""},c.replace("/shop")}}});export{I as a,C as c,m as s};
