import{s as x}from"./statesStore-1222e2d4.js";import{q as M,o as g,V as $}from"./tw-elements.es.min-69e8dc80.js";import{m as D}from"./modalMixin-a9be93c2.js";import{c as w,o as d,d as c,e,t as u,l as h,v as m,S,g as p,r as _,f as b,F as y,i as L}from"./index-bf4ebe37.js";import{D as T,P as z}from"./PaginationBackend-4f3459f0.js";const V={props:{coupon:{type:Object,default(){return{tempCoupon:{}}}},state:{type:String,default:""}},watch:{coupon(){this.tempCoupon=this.coupon}},data(){return{tempCoupon:{},datepicker:{},loadingIcon:!1}},methods:{date(){this.datepicker.open()}},mounted(){M({Datepicker:g,Input:$}),this.datepicker=new g(this.$refs.due_date,{disablePast:!0})},created(){},mixins:[D]},P={"data-te-modal-init":"",class:"fixed left-0 top-0 z-[1055] hidden h-full w-full overflow-y-auto overflow-x-hidden outline-none",id:"addModal",tabindex:"-1","aria-labelledby":"productModal","aria-modal":"true",role:"dialog","data-te-backdrop":"static",ref:"modal"},U={"data-te-modal-dialog-ref":"",class:"pointer-events-none relative mt-7 w-auto translate-y-[-50px] px-2 opacity-0 transition-all duration-300 ease-in-out min-[576px]:mx-auto min-[576px]:max-w-[800px] sm:px-5"},j={class:"pointer-events-auto relative flex max-h-[94vh] w-full flex-col rounded-md border-none bg-white bg-clip-padding text-current shadow-lg outline-none lg:max-h-[90vh]"},E={class:"flex flex-shrink-0 items-center justify-between rounded-t-md border-b-2 border-neutral-100 border-opacity-100 p-4"},A={class:"text-xl font-medium leading-normal text-neutral-800",id:"exampleModalXlLabel"},B=e("button",{type:"button",class:"box-content rounded-none border-none hover:no-underline hover:opacity-75 focus:opacity-100 focus:shadow-none focus:outline-none","data-te-modal-dismiss":"","aria-label":"Close"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor",class:"h-6 w-6"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 18L18 6M6 6l12 12"})])],-1),F={class:"relative overflow-y-auto p-4"},I={class:"mb-4 flex gap-2"},N={class:"w-1/2"},q=e("label",{for:"name",class:"mb-1 block"},[p(" 優惠名稱 "),e("span",{class:"text-danger"},"*")],-1),G={class:"w-1/2"},O=e("label",{for:"number",class:"mb-1 block"},[p(" 優惠碼 "),e("span",{class:"text-danger"},"*")],-1),R={class:"mb-4 flex gap-2"},X={class:"w-1/2"},Z=e("label",{for:"discount",class:"mb-1 block"},[p(" 折扣百分比 "),e("span",{class:"text-danger"},"*")],-1),H={class:"w-1/2"},J=e("label",{for:"date",class:"mb-1 block"},[p(" 到期日 "),e("span",{class:"text-danger"},"*")],-1),K={class:"relative mb-3","data-te-inline":"true","data-te-format":"yyyy-mm-dd","data-te-class-datepicker-cell-content":"group-[[data-te-datepicker-cell-selected]]:font-black",ref:"due_date"},Q=["checked"],W=e("label",{class:"inline-block pl-[0.15rem] hover:cursor-pointer",for:"flexSwitchCheckDefault"},[p(" 是否啟用 "),e("span",{class:"text-danger"},"*")],-1),Y={class:"flex flex-shrink-0 flex-wrap items-center justify-end gap-2 rounded-b-md border-t-2 border-neutral-100 border-opacity-100 p-4"},ee=e("button",{type:"button",class:"active:bg-cerulean-700 inline-block rounded border border-gray-300 bg-transparent px-[23px] py-[9px] text-right text-sm font-medium uppercase leading-normal text-black transition duration-150 ease-in-out hover:bg-gray-100 hover:opacity-80 focus:outline-none focus:ring-0","data-te-modal-dismiss":""}," 取消 ",-1);function te(n,t,i,r,o,a){return d(),c("div",P,[e("div",U,[e("div",j,[e("div",E,[e("h5",A,u(i.state==="new"?"新增":"編輯")+"優惠券 ",1),B]),e("div",F,[e("div",null,[e("div",I,[e("div",N,[q,h(e("input",{type:"text",class:"focus:border-primary m-0 block w-full rounded border border-solid border-neutral-300 bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",placeholder:"請輸入優惠名稱",id:"name","onUpdate:modelValue":t[0]||(t[0]=s=>o.tempCoupon.title=s)},null,512),[[m,o.tempCoupon.title]])]),e("div",G,[O,h(e("input",{type:"text",class:"focus:border-primary m-0 block w-full rounded border border-solid border-neutral-300 bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",placeholder:"請輸入優惠號碼",id:"number","onUpdate:modelValue":t[1]||(t[1]=s=>o.tempCoupon.code=s)},null,512),[[m,o.tempCoupon.code]])])]),e("div",R,[e("div",X,[Z,h(e("input",{type:"number",min:"0",max:"100",class:"focus:border-primary m-0 block w-full rounded border border-solid border-neutral-300 bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none",placeholder:"請輸入數字，預設為 100",id:"discount","onUpdate:modelValue":t[2]||(t[2]=s=>o.tempCoupon.percent=s)},null,512),[[m,o.tempCoupon.percent]])]),e("div",H,[J,e("div",K,[h(e("input",{type:"text",class:"focus:border-primary peer-focus:text-primary :placeholder:opacity-0 peer m-0 block min-h-[auto] w-full rounded border border-solid border-neutral-300 bg-transparent bg-clip-padding px-3 py-[0.25rem] text-base font-normal leading-[1.6] text-neutral-700 outline-none transition duration-200 ease-in-out focus:z-[3] focus:text-neutral-700 focus:shadow-[inset_0_0_0_1px_rgb(59,113,202)] focus:outline-none focus:placeholder:opacity-100 data-[te-input-state-active]:placeholder:opacity-100 motion-reduce:transition-none",placeholder:"請選擇到期日",id:"date","onUpdate:modelValue":t[3]||(t[3]=s=>o.tempCoupon.date=s),onClick:t[4]||(t[4]=(...s)=>a.date&&a.date(...s))},null,512),[[m,o.tempCoupon.date]])],512)])]),e("div",null,[h(e("input",{class:"mr-2 mt-[0.3rem] h-3.5 w-8 appearance-none rounded-[0.4375rem] bg-neutral-300 before:pointer-events-none before:absolute before:h-3.5 before:w-3.5 before:rounded-full before:bg-transparent before:content-[''] after:absolute after:z-[2] after:-mt-[0.1875rem] after:h-5 after:w-5 after:rounded-full after:border-none after:bg-neutral-100 after:shadow-[0_0px_3px_0_rgb(0_0_0_/_7%),_0_2px_2px_0_rgb(0_0_0_/_4%)] after:transition-[background-color_0.2s,transform_0.2s] after:content-[''] checked:bg-success checked:after:absolute checked:after:z-[2] checked:after:-mt-[3px] checked:after:ml-[1.0625rem] checked:after:h-5 checked:after:w-5 checked:after:rounded-full checked:after:border-none checked:after:bg-neutral-100 checked:after:shadow-[0_3px_1px_-2px_rgba(0,0,0,0.2),_0_2px_2px_0_rgba(0,0,0,0.14),_0_1px_5px_0_rgba(0,0,0,0.12)] checked:after:transition-[background-color_0.2s,transform_0.2s] checked:after:content-[''] hover:cursor-pointer focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[3px_-1px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] focus:after:absolute focus:after:z-[1] focus:after:block focus:after:h-5 focus:after:w-5 focus:after:rounded-full focus:after:content-[''] checked:focus:border-success checked:focus:bg-success checked:focus:before:ml-[1.0625rem] checked:focus:before:scale-100 checked:focus:before:shadow-[3px_-1px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s]",type:"checkbox",role:"switch",id:"flexSwitchCheckDefault",checked:o.tempCoupon.is_enabled,"onUpdate:modelValue":t[5]||(t[5]=s=>o.tempCoupon.is_enabled=s)},null,8,Q),[[S,o.tempCoupon.is_enabled]]),W])])]),e("div",Y,[ee,e("button",{type:"button",class:"active:bg-cerulean-700 inline-block rounded bg-cerulean px-6 py-2.5 text-right text-sm font-medium uppercase leading-normal text-white transition duration-150 ease-in-out hover:opacity-80 focus:outline-none focus:ring-0",onClick:t[6]||(t[6]=s=>n.$emit("update-coupons",this.tempCoupon))}," 確認 ")])])])],512)}const oe=w(V,[["render",te]]),se={data(){return{coupons:[],tempCoupon:{},couponModalState:"",pagination:{},isLoading:!1}},methods:{getCoupons(n=1){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/yu-api/admin/coupons?page=${n}`;this.$http.get(t).then(i=>{i.data.success&&(this.coupons=i.data.coupons,this.pagination=i.data.pagination,this.isLoading=!1)})},updateCoupons(n){this.tempCoupon=n,this.tempCoupon.is_enabled===void 0&&(this.tempCoupon.is_enabled=!1),this.tempCoupon.is_enabled=this.tempCoupon.is_enabled?1:0;const t=Math.floor(new Date().getTime()/1e3);this.tempCoupon.lastEditDate=t;const i=this.tempCoupon.date,r=new Date(`${i}T00:00:00Z`);this.tempCoupon.due_date=Math.floor(r.getTime()/1e3);let o="post",a="https://vue3-course-api.hexschool.io/api/yu-api/admin/coupon";this.couponModalState==="edit"&&(o="put",a=`https://vue3-course-api.hexschool.io/api/yu-api/admin/coupon/${n.id}`),this.$http[o](a,{data:this.tempCoupon}).then(s=>{const f=x();s.data.success?(this.$refs.couponModal.hideModal(),this.getCoupons(),this.tempCoupon={},f.pushToastMessage(s.data.success,`${this.couponModalState==="new"?"新增":"編輯"}成功`)):f.pushToastMessage(s.data.success,`${this.couponModalState==="new"?"新增":"編輯"}失敗`,s.data.message)})},openModal(n,t){if(this.couponModalState=n,n==="edit"||n==="del"?this.tempCoupon={...t}:n==="new"&&(this.tempCoupon={}),n==="del"){this.$refs.delModal.showModal();return}this.$refs.couponModal.showModal()},delCoupon(n){const t=x(),i=`https://vue3-course-api.hexschool.io/api/yu-api/admin/coupon/${n.id}`;this.$http.delete(i).then(r=>{r.data.success?(this.$refs.delModal.hideModal(),this.getCoupons(),t.pushToastMessage(r.data.success,"刪除成功")):t.pushToastMessage(r.data.success,"刪除失敗",r.data.message)})}},created(){this.getCoupons()},components:{CouponModal:oe,DelModal:T,Pagination:z}},ne={class:"ml-0 lg:ml-[310px]"},ae={class:"container flex justify-between py-4 lg:mt-10 lg:text-right"},le=e("h2",{class:"flex items-center font-noto-serif text-3xl text-black"},[e("span",{class:"material-symbols-outlined mr-2 text-4xl text-black-light"},"sell"),p(" 優惠券 ")],-1),ie=e("span",{class:"material-symbols-outlined"},"add",-1),re={class:"container mb-11 flex min-h-[679px] flex-col"},de={class:"overflow-x-auto"},ce={class:"inline-block min-w-full py-2"},pe={class:"overflow-hidden"},ue={class:"min-w-full text-left text-sm font-light"},he=e("thead",{class:"break-keep border-b border-gray-400 font-medium"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-4"},"名稱"),e("th",{scope:"col",class:"w-[10%] px-6 py-4"},"優惠碼"),e("th",{scope:"col",class:"w-[10%] px-6 py-4"},"折扣百分比"),e("th",{scope:"col",class:"w-[10%] px-6 py-4"},"到期日"),e("th",{scope:"col",class:"w-[10%] px-6 py-4"},"啟用狀態"),e("th",{scope:"col",class:"w-[10%] px-6 py-4"},"最後更新時間"),e("th",{scope:"col",class:"w-[10%] px-6 py-4"},"編輯")])],-1),fe={class:"whitespace-nowrap px-6 py-4"},me={class:"whitespace-nowrap px-6 py-4 font-normal"},_e={class:"flex items-center"},be={class:"whitespace-nowrap px-6 py-4 font-normal"},xe={class:"whitespace-nowrap px-6 py-4 font-normal"},ge={class:"whitespace-nowrap px-6 py-4 font-normal"},ye={key:0,class:"font-normal text-success"},we={key:1,class:"text-gray-400"},ke={class:"whitespace-nowrap px-6 py-4"},ve={key:0},Ce={key:1},Me={class:"whitespace-nowrap px-6 py-4"},$e=["onClick"],De=e("span",{class:"material-symbols-outlined",style:{"font-variation-settings":`'FILL' 1,
                            'wght' 400,
                            'GRAD' 0,
                            'opsz' 24`}}," edit ",-1),Se=[De],Le=["onClick"],Te=e("span",{class:"material-symbols-outlined"},"delete",-1),ze=[Te];function Ve(n,t,i,r,o,a){const s=_("LoadingAnimation"),f=_("CouponModal"),k=_("DelModal"),v=_("Pagination");return d(),c(y,null,[b(s,{active:o.isLoading,"lock-scroll":!0},null,8,["active"]),e("main",ne,[e("div",ae,[le,e("button",{type:"button",class:"active:bg-cerulean-700 my-auto flex items-center rounded bg-cerulean px-6 py-2.5 text-sm font-medium uppercase leading-normal text-white transition duration-150 ease-in-out hover:opacity-80 focus:outline-none focus:ring-0",onClick:t[0]||(t[0]=l=>a.openModal("new"))},[ie,p(" 新增優惠券 ")])]),e("div",re,[e("div",de,[e("div",ce,[e("div",pe,[e("table",ue,[he,e("tbody",null,[(d(!0),c(y,null,L(o.coupons,l=>(d(),c("tr",{key:l.id,class:"border-b transition duration-300 ease-in-out hover:bg-neutral-100"},[e("th",fe,u(l.title),1),e("td",me,[e("div",_e,u(l.code),1)]),e("td",be,u(n.$filters.currency(l.percent))+" %",1),e("td",xe,u(n.$filters.onlyDate(l.due_date)),1),e("td",ge,[l.is_enabled?(d(),c("p",ye,"啟用")):(d(),c("p",we,"未啟用"))]),e("td",ke,[l.lastEditDate?(d(),c("p",ve,u(n.$filters.date(l.lastEditDate)),1)):(d(),c("p",Ce,"無紀錄"))]),e("td",Me,[e("button",{type:"button",class:"inline-block pr-4 hover:text-cerulean",onClick:C=>a.openModal("edit",l)},Se,8,$e),e("button",{type:"button",class:"inline-block px-4 hover:text-danger",onClick:C=>a.openModal("del",l)},ze,8,Le)])]))),128))])])])])])]),b(f,{ref:"couponModal",coupon:o.tempCoupon,onUpdateCoupons:a.updateCoupons,state:o.couponModalState},null,8,["coupon","onUpdateCoupons","state"]),b(k,{ref:"delModal",onDel:a.delCoupon,item:o.tempCoupon},null,8,["onDel","item"]),b(v,{pages:o.pagination,onChangePage:a.getCoupons},null,8,["pages","onChangePage"])])],64)}const Be=w(se,[["render",Ve]]);export{Be as default};
