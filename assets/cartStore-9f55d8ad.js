import{I as l,J as o,M as c}from"./index-ca38e9cf.js";import{S as i}from"./swalMixin-324c732d.js";const m=l("cart",{state:()=>({cartList:JSON.parse(localStorage.getItem("cartList"))||[],cartTotalPrice:0,finalTotalPrice:0,status:{updateIcon:"",loadingIcon:"",isLoading:!1,coupon:!1},currentStep:1,userInfo:{user:{name:"",email:"",tel:"",address:"",order:{is_paid:!1,status:"",pickup:""}},message:""},OrderData:{}}),actions:{getCartList(){this.cartTotalPrice=0,this.cartList.forEach(t=>{this.cartTotalPrice+=t.final_total}),localStorage.setItem("cartList",JSON.stringify(this.cartList))},addToCart(t,a=1){const s=this.cartList.find(e=>e.product.id===t.id);s?(s.qty+=a,s.final_total=t.price*s.qty):this.cartList.push({product:t,id:t.id,qty:a,final_total:t.price*a}),i.methods.showSwalToast("success","加入購物車"),this.getCartList()},updateCart(t,a){const s=this.cartList.find(r=>r.id===t),e=parseInt(a,10);s.qty=e,s.final_total=s.product.price*s.qty,i.methods.showSwalToast("success","更新購物車"),this.getCartList()},delCartItem(t,a){const s=this.cartList.findIndex(e=>e.id===a);t==="all"?(this.cartList=[],i.methods.showSwalToast("success","已清空購物車")):t==="one"&&(this.cartList.splice(s,1),i.methods.showSwalToast("success","已刪除商品")),this.getCartList()},checkCartList(t){this.status.isLoading=!0,this.userInfo.user.order.pickupMethod=t;const a="https://vue3-course-api.hexschool.io/api/yu-api/carts";o.delete(a).then(s=>{let e=0;if(s.data.success||s.data.success===!1){const r="https://vue3-course-api.hexschool.io/api/yu-api/cart";this.cartList.forEach(h=>{const n={data:{product_id:h.product.id,qty:h.qty}};o.post(r,n).then(u=>{if(u.data.success&&(e+=1),e===this.cartList.length){if(c.push("/checkout/information"),this.status.isLoading=!1,t==="self")this.userInfo.user.address="到店自取";else if(t==="delivery"){const d={final_total:80,id:"-Nfviy3OLgcT7GnSUqUV",qty:1,price:80,category:"運費",imageUrl:"https://storage.googleapis.com/vue-course-api.appspot.com/yu-api/1696471229222.jpg?GoogleAccessId=firebase-adminsdk-zzty7%40vue-course-api.iam.gserviceaccount.com&Expires=1742169600&Signature=coobBweHW0lLquqGySO4Ejimw22pG%2F2BEi9pheRmVm2xkZRWtRYzDORK6UiyoBqMMsfBWXmTcLmJFWayWVqXe44V0xsA%2FsvpmTaOrmYdlzGlrefhGsPjpjsOIP8LbbnDqCVnszWeZU3Dh2s0%2F%2FNP43OE8xL5h%2B3c5QHKf0Z3vVkd3a8BHu4H08keCoO%2FbIZfWCKlGWV3JhnkBokpJV0IEwKQmr9BJ%2FdrwdG%2BHe5BfsOeBM9AO4HgZrKztXLDwyXkysk6mkupr5a74mMXDTyGU%2BMgCdSnrEsLQzKsjXr2kzsEsTIf0KxD6AaPfiZXgdO22GXyWFy%2BPzRwYB11CLNobA%3D%3D",num:1,origin_price:80,title:"運費",unit:"運費"};this.addToCart(d,1)}}})})}})},updateCurrentStep(t){t===2&&(this.status.coupon=!1),this.currentStep=t},pushUserInfo(t){this.userInfo=t},useCoupon(t){this.status.isLoading=!0;const a="https://vue3-course-api.hexschool.io/api/yu-api/coupon";o.post(a,{data:{code:t}}).then(s=>{s.data.success?(this.status.coupon=!0,this.finalTotalPrice=s.data.data.final_total,i.methods.showSwalToast("success","套用成功")):i.methods.showSwalToast("error",s.data.message),this.status.isLoading=!1})},finishOrder(){this.status.isLoading=!0,this.userInfo.user.order.status="收到訂單";const t="https://vue3-course-api.hexschool.io/api/yu-api/order";o.post(t,{data:this.userInfo}).then(a=>{a.data.success&&(this.OrderData=a.data,this.cartList=[],localStorage.setItem("cartList",JSON.stringify(this.cartList)),c.replace("/checkout/complete"),this.status.isLoading=!1)})},shoppingMore(){c.replace("/shop"),this.userInfo={user:{name:"",email:"",tel:"",address:""},message:""}}}});export{m as c};
